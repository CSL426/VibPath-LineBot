"""
LINE Bot Flex Message templates for various content types.
Provides reusable templates for weather, general info, menus, etc.
"""
from typing import Dict, Any, List, Optional
from linebot.models import FlexSendMessage, BubbleContainer, CarouselContainer


class FlexMessageTemplates:
    """Collection of Flex Message templates for LINE Bot"""

    @staticmethod
    def weather_card(weather_data: Dict[str, Any]) -> FlexSendMessage:
        """
        Create a weather information Flex Message card.

        Args:
            weather_data: Dictionary containing weather information

        Returns:
            FlexSendMessage: Formatted weather card
        """
        data = weather_data.get('data', {})
        city = data.get('city', 'Unknown')
        country = data.get('country', '')
        location = f"{city}, {country}" if country else city

        bubble = BubbleContainer(
            direction='ltr',
            hero={
                "type": "image",
                "url": "https://via.placeholder.com/1024x640/87CEEB/FFFFFF?text=Weather",  # TODO: ÊõøÊèõÁÇ∫ÂØ¶ÈöõÂ§©Ê∞£ÂúñÁâá
                "size": "full",
                "aspectRatio": "20:13",
                "aspectMode": "cover"
            },
            body={
                "type": "box",
                "layout": "vertical",
                "contents": [
                    {
                        "type": "text",
                        "text": f"üå§Ô∏è {location}",
                        "weight": "bold",
                        "size": "xl",
                        "color": "#1976D2"
                    },
                    {
                        "type": "box",
                        "layout": "vertical",
                        "margin": "lg",
                        "spacing": "sm",
                        "contents": [
                            {
                                "type": "box",
                                "layout": "baseline",
                                "spacing": "sm",
                                "contents": [
                                    {
                                        "type": "text",
                                        "text": "üå°Ô∏è Ê∫´Â∫¶",
                                        "color": "#666666",
                                        "size": "sm",
                                        "flex": 2
                                    },
                                    {
                                        "type": "text",
                                        "text": f"{data.get('temperature', 'N/A')} ({data.get('temperature_f', 'N/A')})",
                                        "wrap": True,
                                        "color": "#333333",
                                        "size": "sm",
                                        "flex": 3
                                    }
                                ]
                            },
                            {
                                "type": "box",
                                "layout": "baseline",
                                "spacing": "sm",
                                "contents": [
                                    {
                                        "type": "text",
                                        "text": "‚òÅÔ∏è Â§©Ê∞£",
                                        "color": "#666666",
                                        "size": "sm",
                                        "flex": 2
                                    },
                                    {
                                        "type": "text",
                                        "text": data.get('condition', 'N/A'),
                                        "wrap": True,
                                        "color": "#333333",
                                        "size": "sm",
                                        "flex": 3
                                    }
                                ]
                            },
                            {
                                "type": "box",
                                "layout": "baseline",
                                "spacing": "sm",
                                "contents": [
                                    {
                                        "type": "text",
                                        "text": "üíß ÊøïÂ∫¶",
                                        "color": "#666666",
                                        "size": "sm",
                                        "flex": 2
                                    },
                                    {
                                        "type": "text",
                                        "text": data.get('humidity', 'N/A'),
                                        "wrap": True,
                                        "color": "#333333",
                                        "size": "sm",
                                        "flex": 3
                                    }
                                ]
                            },
                            {
                                "type": "box",
                                "layout": "baseline",
                                "spacing": "sm",
                                "contents": [
                                    {
                                        "type": "text",
                                        "text": "üå¨Ô∏è È¢®ÈÄü",
                                        "color": "#666666",
                                        "size": "sm",
                                        "flex": 2
                                    },
                                    {
                                        "type": "text",
                                        "text": f"{data.get('wind_speed', 'N/A')} ({data.get('wind_direction', 'N/A')})",
                                        "wrap": True,
                                        "color": "#333333",
                                        "size": "sm",
                                        "flex": 3
                                    }
                                ]
                            }
                        ]
                    }
                ]
            },
            footer={
                "type": "box",
                "layout": "vertical",
                "spacing": "sm",
                "contents": [
                    {
                        "type": "button",
                        "style": "primary",
                        "height": "sm",
                        "action": {
                            "type": "message",
                            "label": "üîÑ Êõ¥Êñ∞Â§©Ê∞£",
                            "text": f"{city}Â§©Ê∞£"
                        }
                    },
                    {
                        "type": "button",
                        "style": "secondary",
                        "height": "sm",
                        "action": {
                            "type": "uri",
                            "label": "üìä Ë©≥Á¥∞Ë≥áË®ä",
                            "uri": f"https://wttr.in/{city}"
                        }
                    }
                ]
            }
        )

        return FlexSendMessage(alt_text=f"{location} Â§©Ê∞£Ë≥áË®ä", contents=bubble)

    @staticmethod
    def service_menu() -> FlexSendMessage:
        """
        Create a service menu Flex Message.

        Returns:
            FlexSendMessage: Service menu card
        """
        bubble = BubbleContainer(
            hero={
                "type": "image",
                "url": "https://via.placeholder.com/1024x640/4CAF50/FFFFFF?text=VibPath+Services",
                "size": "full",
                "aspectRatio": "20:13",
                "aspectMode": "cover"
            },
            body={
                "type": "box",
                "layout": "vertical",
                "contents": [
                    {
                        "type": "text",
                        "text": "ü§ñ VibPath Êô∫ËÉΩÂÆ¢Êúç",
                        "weight": "bold",
                        "size": "xl",
                        "color": "#1976D2"
                    },
                    {
                        "type": "text",
                        "text": "ÈÅ∏ÊìáÊÇ®ÈúÄË¶ÅÁöÑÊúçÂãô",
                        "size": "md",
                        "color": "#666666",
                        "margin": "md"
                    },
                    {
                        "type": "separator",
                        "margin": "xl"
                    },
                    {
                        "type": "box",
                        "layout": "vertical",
                        "margin": "xl",
                        "spacing": "sm",
                        "contents": [
                            {
                                "type": "box",
                                "layout": "horizontal",
                                "contents": [
                                    {
                                        "type": "text",
                                        "text": "üå§Ô∏è",
                                        "size": "xl",
                                        "flex": 1
                                    },
                                    {
                                        "type": "box",
                                        "layout": "vertical",
                                        "flex": 4,
                                        "contents": [
                                            {
                                                "type": "text",
                                                "text": "Â§©Ê∞£Êü•Ë©¢",
                                                "weight": "bold",
                                                "size": "md"
                                            },
                                            {
                                                "type": "text",
                                                "text": "Êü•Ë©¢ÂÖ®ÁêÉÂüéÂ∏ÇÂç≥ÊôÇÂ§©Ê∞£",
                                                "size": "sm",
                                                "color": "#666666"
                                            }
                                        ]
                                    }
                                ],
                                "spacing": "md",
                                "paddingAll": "sm"
                            },
                            {
                                "type": "separator"
                            },
                            {
                                "type": "box",
                                "layout": "horizontal",
                                "contents": [
                                    {
                                        "type": "text",
                                        "text": "üí¨",
                                        "size": "xl",
                                        "flex": 1
                                    },
                                    {
                                        "type": "box",
                                        "layout": "vertical",
                                        "flex": 4,
                                        "contents": [
                                            {
                                                "type": "text",
                                                "text": "Êô∫ËÉΩÂ∞çË©±",
                                                "weight": "bold",
                                                "size": "md"
                                            },
                                            {
                                                "type": "text",
                                                "text": "AI Âä©ÊâãÁÇ∫ÊÇ®Ëß£Á≠îÂïèÈ°å",
                                                "size": "sm",
                                                "color": "#666666"
                                            }
                                        ]
                                    }
                                ],
                                "spacing": "md",
                                "paddingAll": "sm"
                            }
                        ]
                    }
                ]
            },
            footer={
                "type": "box",
                "layout": "vertical",
                "spacing": "sm",
                "contents": [
                    {
                        "type": "button",
                        "style": "primary",
                        "action": {
                            "type": "message",
                            "label": "üå§Ô∏è Êü•Ë©¢Â§©Ê∞£",
                            "text": "Âè∞ÂåóÂ§©Ê∞£"
                        }
                    },
                    {
                        "type": "button",
                        "style": "secondary",
                        "action": {
                            "type": "message",
                            "label": "üí¨ ÈñãÂßãÂ∞çË©±",
                            "text": "‰Ω†Â•Ω"
                        }
                    }
                ]
            }
        )

        return FlexSendMessage(alt_text="VibPath ÊúçÂãôÈÅ∏ÂñÆ", contents=bubble)

    @staticmethod
    def error_message(error_text: str) -> FlexSendMessage:
        """
        Create an error message Flex Message.

        Args:
            error_text: Error message to display

        Returns:
            FlexSendMessage: Error message card
        """
        bubble = BubbleContainer(
            body={
                "type": "box",
                "layout": "vertical",
                "contents": [
                    {
                        "type": "text",
                        "text": "‚ùå ÁôºÁîüÈåØË™§",
                        "weight": "bold",
                        "size": "xl",
                        "color": "#E53E3E"
                    },
                    {
                        "type": "text",
                        "text": error_text,
                        "size": "md",
                        "color": "#666666",
                        "margin": "md",
                        "wrap": True
                    }
                ]
            },
            footer={
                "type": "box",
                "layout": "vertical",
                "contents": [
                    {
                        "type": "button",
                        "style": "secondary",
                        "action": {
                            "type": "message",
                            "label": "üîÑ ÈáçË©¶",
                            "text": "ÈáçË©¶"
                        }
                    }
                ]
            }
        )

        return FlexSendMessage(alt_text="ÈåØË™§Ë®äÊÅØ", contents=bubble)

    @staticmethod
    def welcome_carousel() -> FlexSendMessage:
        """
        Create a welcome carousel with multiple service cards.

        Returns:
            FlexSendMessage: Welcome carousel
        """
        # TODO: ÂØ¶ÁèæÊ≠°ËøéËº™Êí≠Âç°Áâá
        # ÂèØ‰ª•ÂåÖÂê´ÔºöÊúçÂãô‰ªãÁ¥π„ÄÅÂäüËÉΩÂ±ïÁ§∫„ÄÅ‰ΩøÁî®ÊåáÂçóÁ≠â
        pass

    @staticmethod
    def quick_reply_weather_cities() -> Dict[str, Any]:
        """
        Create quick reply options for popular cities.

        Returns:
            Dict: Quick reply items for weather queries
        """
        # TODO: ÂØ¶ÁèæÂø´ÈÄüÂõûË¶ÜÈÅ∏È†Ö
        # ÂèØ‰ª•ÂåÖÂê´ÔºöÁÜ±ÈñÄÂüéÂ∏Ç„ÄÅÊúÄËøëÊü•Ë©¢„ÄÅËá™ÂÆöÁæ©ÂüéÂ∏ÇÁ≠â
        pass